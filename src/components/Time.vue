<template>
  <div class="time">
    <div class="header">
      <strong>{{ timeLabel }}</strong>
    </div>
    <hr class="spacer" />
    <div class="hours">
      <div class="icon icon--sun">
        <svg width="40" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50">
          <path
            d="M 24.90625 3.96875 C 24.863281 3.976563 24.820313 3.988281 24.78125 4 C 24.316406 4.105469 23.988281 4.523438 24 5 L 24 11 C 23.996094 11.359375 24.183594 11.695313 24.496094 11.878906 C 24.808594 12.058594 25.191406 12.058594 25.503906 11.878906 C 25.816406 11.695313 26.003906 11.359375 26 11 L 26 5 C 26.011719 4.710938 25.894531 4.433594 25.6875 4.238281 C 25.476563 4.039063 25.191406 3.941406 24.90625 3.96875 Z M 10.65625 9.84375 C 10.28125 9.910156 9.980469 10.183594 9.875 10.546875 C 9.769531 10.914063 9.878906 11.304688 10.15625 11.5625 L 14.40625 15.8125 C 14.648438 16.109375 15.035156 16.246094 15.410156 16.160156 C 15.78125 16.074219 16.074219 15.78125 16.160156 15.410156 C 16.246094 15.035156 16.109375 14.648438 15.8125 14.40625 L 11.5625 10.15625 C 11.355469 9.933594 11.054688 9.820313 10.75 9.84375 C 10.71875 9.84375 10.6875 9.84375 10.65625 9.84375 Z M 39.03125 9.84375 C 38.804688 9.875 38.59375 9.988281 38.4375 10.15625 L 34.1875 14.40625 C 33.890625 14.648438 33.753906 15.035156 33.839844 15.410156 C 33.925781 15.78125 34.21875 16.074219 34.589844 16.160156 C 34.964844 16.246094 35.351563 16.109375 35.59375 15.8125 L 39.84375 11.5625 C 40.15625 11.265625 40.246094 10.800781 40.0625 10.410156 C 39.875 10.015625 39.460938 9.789063 39.03125 9.84375 Z M 24.90625 15 C 24.875 15.007813 24.84375 15.019531 24.8125 15.03125 C 24.75 15.035156 24.6875 15.046875 24.625 15.0625 C 24.613281 15.074219 24.605469 15.082031 24.59375 15.09375 C 19.289063 15.320313 15 19.640625 15 25 C 15 30.503906 19.496094 35 25 35 C 30.503906 35 35 30.503906 35 25 C 35 19.660156 30.746094 15.355469 25.46875 15.09375 C 25.433594 15.09375 25.410156 15.0625 25.375 15.0625 C 25.273438 15.023438 25.167969 15.003906 25.0625 15 C 25.042969 15 25.019531 15 25 15 C 24.96875 15 24.9375 15 24.90625 15 Z M 24.9375 17 C 24.957031 17 24.980469 17 25 17 C 25.03125 17 25.0625 17 25.09375 17 C 29.46875 17.050781 33 20.613281 33 25 C 33 29.421875 29.421875 33 25 33 C 20.582031 33 17 29.421875 17 25 C 17 20.601563 20.546875 17.035156 24.9375 17 Z M 4.71875 24 C 4.167969 24.078125 3.78125 24.589844 3.859375 25.140625 C 3.9375 25.691406 4.449219 26.078125 5 26 L 11 26 C 11.359375 26.003906 11.695313 25.816406 11.878906 25.503906 C 12.058594 25.191406 12.058594 24.808594 11.878906 24.496094 C 11.695313 24.183594 11.359375 23.996094 11 24 L 5 24 C 4.96875 24 4.9375 24 4.90625 24 C 4.875 24 4.84375 24 4.8125 24 C 4.78125 24 4.75 24 4.71875 24 Z M 38.71875 24 C 38.167969 24.078125 37.78125 24.589844 37.859375 25.140625 C 37.9375 25.691406 38.449219 26.078125 39 26 L 45 26 C 45.359375 26.003906 45.695313 25.816406 45.878906 25.503906 C 46.058594 25.191406 46.058594 24.808594 45.878906 24.496094 C 45.695313 24.183594 45.359375 23.996094 45 24 L 39 24 C 38.96875 24 38.9375 24 38.90625 24 C 38.875 24 38.84375 24 38.8125 24 C 38.78125 24 38.75 24 38.71875 24 Z M 15 33.875 C 14.773438 33.90625 14.5625 34.019531 14.40625 34.1875 L 10.15625 38.4375 C 9.859375 38.679688 9.722656 39.066406 9.808594 39.441406 C 9.894531 39.8125 10.1875 40.105469 10.558594 40.191406 C 10.933594 40.277344 11.320313 40.140625 11.5625 39.84375 L 15.8125 35.59375 C 16.109375 35.308594 16.199219 34.867188 16.039063 34.488281 C 15.882813 34.109375 15.503906 33.867188 15.09375 33.875 C 15.0625 33.875 15.03125 33.875 15 33.875 Z M 34.6875 33.875 C 34.3125 33.941406 34.011719 34.214844 33.90625 34.578125 C 33.800781 34.945313 33.910156 35.335938 34.1875 35.59375 L 38.4375 39.84375 C 38.679688 40.140625 39.066406 40.277344 39.441406 40.191406 C 39.8125 40.105469 40.105469 39.8125 40.191406 39.441406 C 40.277344 39.066406 40.140625 38.679688 39.84375 38.4375 L 35.59375 34.1875 C 35.40625 33.988281 35.148438 33.878906 34.875 33.875 C 34.84375 33.875 34.8125 33.875 34.78125 33.875 C 34.75 33.875 34.71875 33.875 34.6875 33.875 Z M 24.90625 37.96875 C 24.863281 37.976563 24.820313 37.988281 24.78125 38 C 24.316406 38.105469 23.988281 38.523438 24 39 L 24 45 C 23.996094 45.359375 24.183594 45.695313 24.496094 45.878906 C 24.808594 46.058594 25.191406 46.058594 25.503906 45.878906 C 25.816406 45.695313 26.003906 45.359375 26 45 L 26 39 C 26.011719 38.710938 25.894531 38.433594 25.6875 38.238281 C 25.476563 38.039063 25.191406 37.941406 24.90625 37.96875 Z"
          ></path>
        </svg>
      </div>
      <button
        class="selection hour"
        :class="{ 'selection--active': selectedHour === hour.shortValue }"
        :disabled="checkDisabledDate(hour)"
        @click="selectHour(hour)"
        v-for="hour in dayHours"
        :key="hour.value"
        :title="hour.title"
        v-html="hour.display"
      ></button>
      <div class="icon icon--moon">
        <svg width="40" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50">
          <path
            d="M 31 4 C 19.414063 4 10 13.414063 10 25 C 10 36.585938 19.414063 46 31 46 C 33.988281 46 36.828125 45.367188 39.402344 44.242188 C 39.765625 44.082031 40 43.722656 40 43.324219 C 40 42.925781 39.765625 42.566406 39.402344 42.40625 C 32.695313 39.476563 28 32.796875 28 25 C 28 17.203125 32.695313 10.523438 39.402344 7.59375 C 39.765625 7.433594 40 7.074219 40 6.675781 C 40 6.277344 39.765625 5.917969 39.402344 5.757813 C 36.828125 4.632813 33.988281 4 31 4 Z M 31 6 C 32.984375 6 34.855469 6.398438 36.65625 6.96875 C 30.355469 10.59375 26 17.21875 26 25 C 26 32.78125 30.355469 39.40625 36.65625 43.03125 C 34.855469 43.601563 32.984375 44 31 44 C 20.496094 44 12 35.503906 12 25 C 12 14.496094 20.496094 6 31 6 Z"
          ></path>
        </svg>
      </div>
      <button
        class="selection hour"
        :class="{ 'selection--active': selectedHour === hour.shortValue }"
        :disabled="checkDisabledDate(hour)"
        @click="selectHour(hour)"
        v-for="hour in nightHours"
        :key="hour.value"
        :title="hour.title"
        v-html="hour.display"
      ></button>
    </div>
    <hr class="spacer" />
    <div class="minutes">
      <div class="icon">
        <svg
          width="40"
          height="40"
          viewBox="0 0 50 50"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <circle
            cx="25"
            cy="25"
            r="22"
            stroke="black"
            stroke-width="2"
          ></circle>
          <path
            d="M25 5C24.4492 5 24 5.44922 24 6C24 6.55078 24.4492 7 25 7C25.5508 7 26 6.55078 26 6C26 5.44922 25.5508 5 25 5ZM34.3438 7.5625C34.0586 7.60156 33.7812 7.76172 33.625 8.03125C33.3477 8.50781 33.5234 9.12891 34 9.40625C34.4766 9.68359 35.0977 9.50781 35.375 9.03125C35.6523 8.55469 35.4766 7.96484 35 7.6875C34.8789 7.61719 34.7539 7.57812 34.625 7.5625C34.5273 7.55078 34.4375 7.55078 34.3438 7.5625ZM41.3438 14.5C41.2148 14.5156 41.0586 14.5547 40.9375 14.625C40.4609 14.9023 40.3164 15.5234 40.5938 16C40.8711 16.4766 41.4609 16.6523 41.9375 16.375C42.4141 16.0977 42.5898 15.4766 42.3125 15C42.1055 14.6406 41.7305 14.4531 41.3438 14.5ZM6 24C5.44922 24 5 24.4492 5 25C5 25.5508 5.44922 26 6 26C6.55078 26 7 25.5508 7 25C7 24.4492 6.55078 24 6 24ZM44 24C43.4492 24 43 24.4492 43 25C43 25.5508 43.4492 26 44 26C44.5508 26 45 25.5508 45 25C45 24.4492 44.5508 24 44 24ZM8.4375 33.5C8.30859 33.5156 8.15234 33.5547 8.03125 33.625C7.55469 33.9023 7.41016 34.5234 7.6875 35C7.96484 35.4766 8.55469 35.6523 9.03125 35.375C9.50781 35.0977 9.68359 34.4766 9.40625 34C9.19922 33.6406 8.82422 33.4531 8.4375 33.5ZM41.2812 33.5C41.0039 33.5508 40.75 33.7305 40.5938 34C40.3164 34.4766 40.4922 35.0977 40.9688 35.375C41.4453 35.6523 42.0352 35.4766 42.3125 35C42.5898 34.5234 42.4453 33.9023 41.9688 33.625C41.8477 33.5547 41.6914 33.5156 41.5625 33.5C41.4648 33.4883 41.375 33.4844 41.2812 33.5ZM15.3438 40.4688C15.0586 40.5195 14.7812 40.6992 14.625 40.9688C14.3477 41.4453 14.5234 42.0352 15 42.3125C15.4766 42.5898 16.0977 42.4453 16.375 41.9688C16.6523 41.4922 16.4766 40.8711 16 40.5938C15.8789 40.5234 15.7539 40.4844 15.625 40.4688C15.5273 40.457 15.4375 40.4531 15.3438 40.4688ZM34.375 40.4688C34.2461 40.4844 34.1211 40.5234 34 40.5938C33.5234 40.8711 33.3477 41.4922 33.625 41.9688C33.9023 42.4453 34.5234 42.5898 35 42.3125C35.4766 42.0352 35.6523 41.4453 35.375 40.9688C35.168 40.6094 34.7617 40.4219 34.375 40.4688ZM25 43C24.4492 43 24 43.4492 24 44C24 44.5508 24.4492 45 25 45C25.5508 45 26 44.5508 26 44C26 43.4492 25.5508 43 25 43Z"
            fill="black"
          ></path>
          <path
            d="M14.25 8.03125C14.4062 7.76172 14.6836 7.60156 14.9688 7.5625C15.0625 7.55078 15.1523 7.55078 15.25 7.5625C15.3789 7.57812 15.5039 7.61719 15.625 7.6875C16.1016 7.96484 16.2773 8.55469 16 9.03125C15.7227 9.50781 15.1016 9.68359 14.625 9.40625C14.1484 9.12891 13.9727 8.50781 14.25 8.03125Z"
            fill="black"
          ></path>
          <path
            d="M8.03125 14.625C8.15234 14.5547 8.30859 14.5156 8.4375 14.5C8.82422 14.4531 9.19922 14.6406 9.40625 15C9.68359 15.4766 9.50781 16.0977 9.03125 16.375C8.55469 16.6523 7.96484 16.4766 7.6875 16C7.41016 15.5234 7.55469 14.9023 8.03125 14.625Z"
            fill="black"
          ></path>
          <path
            d="M17.3871 29L15.461 22.7237H15.4118C15.4811 24.0005 15.5157 24.8523 15.5157 25.2791V29H14V21H16.3092L18.2025 27.1176H18.2353L20.2435 21H22.5527V29H20.9713V25.2134C20.9713 25.0347 20.9731 24.8285 20.9767 24.5951C20.984 24.3616 21.0096 23.7415 21.0534 22.7346H21.0041L18.9412 29H17.3871Z"
            fill="black"
          ></path>
          <path d="M24.5718 29V21H26.2681V29H24.5718Z" fill="black"></path>
          <path
            d="M35.3789 29H33.223L29.7428 22.948H29.6936C29.7629 24.0169 29.7975 24.7793 29.7975 25.2353V29H28.2818V21H30.4213L33.896 26.9918H33.9343C33.8796 25.9521 33.8523 25.2171 33.8523 24.7866V21H35.3789V29Z"
            fill="black"
          ></path>
        </svg>
      </div>
      <button
        @click="selectMinute(minute)"
        class="selection minute"
        :class="{ 'selection--active': selectedMinute === minute.shortValue }"
        :disabled="checkDisabledDate(minute)"
        :key="minute.value"
        :title="minute.title"
        v-for="minute in minutes"
      >
        {{ minute.display }}
      </button>
    </div>
  </div>
</template>

<script>
export default {
  name: "Time",
  data: () => ({}),
  props: {
    value: { type: String },
    militaryTime: { type: Boolean },
    dayHour: { type: Number, default: 8 },
    nightHour: { type: Number, default: 20 },
    minuteFormat: { type: String, default: "m" },
    hourFormat: { type: String, default: "H" },
    minuteIncrement: { type: Number, default: 5 },
    minDate: {
      type: String,
      default: "1900-01-01"
    },
    maxDate: {
      type: String,
      default: "2100-01-01"
    },
    timeLabel: {
      type: String,
      default: "Time"
    },
    roundUp: {
      type: Boolean,
      default: true
    }
  },
  watch: {},
  computed: {
    selectedMinute() {
      return dayjs(this.value).minute();
    },
    selectedHour() {
      return dayjs(this.value).hour();
    },
    dayHours() {
      return this.generateHours(this.dayHour, this.nightHour - this.dayHour);
    },
    nightHours() {
      return this.generateHours(this.nightHour, this.nightHour - this.dayHour);
    },
    minutes() {
      const date = dayjs(this.value),
        total = Math.floor(60 / this.minuteIncrement);
      return [...Array(total)].map((_, i) => {
        const minute = date.minute(i * this.minuteIncrement);
        return {
          display: minute.format(this.minuteFormat),
          value: minute.format(),
          title: minute.format("LT"),
          shortValue: i * this.minuteIncrement
        };
      });
    }
  },
  methods: {
    checkDisabledDate(hour) {
      return !dayjs(hour.value).isBetween(this.minDate, this.maxDate);
    },
    generateHours(startHour, total) {
      const date = dayjs(this.value);
      return [...Array(Math.abs(total))].map((_, i) => {
        const hour = date.hour((i + startHour) % 24);
        return {
          display: this.militaryTime
            ? hour.format(this.hourFormat)
            : `${hour.format("h")}<small>${hour.format("a")}</small>`,
          value: hour.format(),
          title: hour.format("LT"),
          shortValue: parseInt(hour.format("H"), 10)
        };
      });
    },
    selectHour(hour) {
      this.updateDate(hour.value);
    },
    selectMinute(minute) {
      this.updateDate(minute.value);
    },
    updateDate(date) {
      this.date = date;
      this.$emit("input", this.date);
    },
    selectClosestMinute() {
      const diff = this.selectedMinute % this.minuteIncrement,
        date = dayjs(this.value).minute(
          this.selectedMinute + (diff ? this.minuteIncrement - diff : diff)
        );
      return this.selectMinute({ value: date.format() });
    }
  },
  created() {
    if (this.roundUp) {
      this.selectClosestMinute();
    }
  }
};
</script>

<style lang="scss">
.time {
  .hours {
    button.hour {
      display: block;
      small {
        font-size: 8px;
        text-transform: uppercase;
      }
    }
  }
}
</style>

<style lang="scss" scoped>
.time {
  margin: 20px 0;
  .hours {
    display: grid;
    grid-template-columns: repeat(7, 40px);
    grid-template-rows: repeat(4, 40px);
    align-content: center;
    text-align: center;
    justify-content: space-between;
    .icon {
      grid-row-end: span 2;
      display: flex;
      align-items: center;
      justify-content: center;
      flex: 0 0 40px;
    }
    .hour {
    }
  }
  .minutes {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 100%;
    overflow: auto;
    .icon {
      position: sticky;
      left: 0;
      // background: white;
      margin: 0 20px 0 0;
    }
    .minute {
      flex: 0 0 40px;
      &:nth-child(3n + 2) {
        font-size: 1.1rem;
        font-weight: 500;
        &::before {
          content: ":";
        }
      }
    }
  }
}
</style>
